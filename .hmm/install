#!/bin/bash
signature

TYPE=local
HMM_INSTALL_PATH=/usr/local/lib

clean_install_local()       { sudo rm -rf "$HMM_INSTALL_PATH/hmm"; }
real_install_local()        { mkdir -p "$HMM_INSTALL_PATH"; sudo cp -R "$HMM_DIR" "$HMM_INSTALL_PATH/."; }

real_bashrc_local()         { echo "export PATH=$HMM_INSTALL_PATH/hmm:$PATH" >> $HOME/.bashrc;
                              echo ". $HMM_INSTALL_PATH/hmm.bash" >> $HOME/.bashrc; }

real_profile_local()        { echo "export PATH=$HMM_INSTALL_PATH/hmm:$PATH" >> $HOME/.bash_profile;
                              echo ". $HMM_INSTALL_PATH/hmm.bash" >> $HOME/.bash_profile; }

install_local() {
    read -e -p "Where would you like HMM installed? " -i "$HOME/bin" HMM_INSTALL_PATH
    echo "Installing from $HMM_DIR to $HMM_INSTALL_PATH"
    if [[ "$HMM_DIR" = "$HMM_INSTALL_PATH/hmm" ]]; then
        echo "ERROR: Same directory!"
        exit 1
    fi
    verify_install_replace \
     "$HMM_INSTALL_PATH/hmm" \
     clean_install_local \
     real_install_local

    read -n 1 -p "Append updates to $HOME/.bashrc? (y/n) "
    [ $REPLY = "y" ] || real_bashrc_local
    echo " "
    read -n 1 -p "Append updates to $HOME/.bash_profile? (y/n) "
    [ $REPLY = "y" ] || real_profile_local
    echo " "

    read -n 1 -p "Run bash completion setup now? (y/n) "
    [ $REPLY = "y" ] || /bin/bash "$HMM_INSTALL_PATH/hmm.bash"
    echo " "
}

clean_install_global()      { sudo rm -rf "$HMM_INSTALL_PATH/hmm"; }
real_install_global()       { sudo cp -R "$HMM_DIR" "$HMM_INSTALL_PATH/."; }

clean_completion_global()   { sudo rm -rf /etc/bash_completion.d/hmm; }
real_completion_global()    { sudo ln -s "$HMM_INSTALL_PATH/hmm/hmm.bash" /etc/bash_completion.d/hmm; }

clean_path_global()         { sudo rm -rf /usr/local/bin/hmm; }
real_path_global()          { sudo ln -s "$HMM_INSTALL_PATH/hmm/hmm" /usr/local/bin/hmm; }

install_global() {
    echo "Installing from $HMM_DIR to $HMM_INSTALL_PATH"
    sudo mkdir -p $HMM_INSTALL_PATH
    verify_install_replace \
     "$HMM_INSTALL_PATH/hmm" \
     clean_install_global \
     real_install_global

    sudo mkdir -p $HMM_INSTALL_PATH
    verify_install_replace \
     "/etc/bash_completion.d/hmm" \
     clean_completion_global \
     real_completion_global
    /bin/bash /etc/bash_completion.d/hmm

    sudo mkdir -p $HMM_INSTALL_PATH
    verify_install_replace \
     "/usr/local/bin/hmm" \
     clean_path_global \
     real_path_global
}

echo "What type of installation?"
select lg in "Local" "Global"; do
    case $lg in
        Local) install_local; break;;
        Global) install_global; break;;
        *) exit;;
    esac
done
